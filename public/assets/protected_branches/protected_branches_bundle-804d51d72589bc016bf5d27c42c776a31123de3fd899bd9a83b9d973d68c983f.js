"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e){e.gl=e.gl||{},gl.ProtectedBranchAccessDropdown=function(){function e(t){_classCallCheck(this,e);var n=t.$dropdown,o=t.data,a=t.onSelect;n.glDropdown({data:o,selectable:!0,inputId:n.data("input-id"),fieldName:n.data("field-name"),toggleLabel:function(e,t){return t.is(".is-active")?e.text:"Select"},clicked:function(e,t,n){n.preventDefault(),a()}})}return e}()}(window);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();!function(e){e.gl=e.gl||{},gl.ProtectedBranchCreate=function(){function e(){_classCallCheck(this,e),this.$wrap=this.$form=$("#new_protected_branch"),this.buildDropdowns()}return _createClass(e,[{key:"buildDropdowns",value:function(){var e=this.$wrap.find(".js-allowed-to-merge"),t=this.$wrap.find(".js-allowed-to-push");this.onSelectCallback=this.onSelect.bind(this),new gl.ProtectedBranchAccessDropdown({$dropdown:e,data:gon.merge_access_levels,onSelect:this.onSelectCallback}),new gl.ProtectedBranchAccessDropdown({$dropdown:t,data:gon.push_access_levels,onSelect:this.onSelectCallback}),t.data("glDropdown").selectRowAtIndex(0),e.data("glDropdown").selectRowAtIndex(0),new ProtectedBranchDropdown({$dropdown:this.$wrap.find(".js-protected-branch-select"),onSelect:this.onSelectCallback})}},{key:"onSelect",value:function(){var e=this.$wrap.find('input[name="protected_branch[name]"]'),t=this.$wrap.find('input[name="protected_branch[merge_access_levels_attributes][0][access_level]"]'),n=this.$wrap.find('input[name="protected_branch[push_access_levels_attributes][0][access_level]"]');this.$form.find('input[type="submit"]').attr("disabled",!(e.val()&&t.length&&n.length))}}]),e}()}(window);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),ProtectedBranchDropdown=function(){function e(t){_classCallCheck(this,e),this.onSelect=t.onSelect,this.$dropdown=t.$dropdown,this.$dropdownContainer=this.$dropdown.parent(),this.$dropdownFooter=this.$dropdownContainer.find(".dropdown-footer"),this.$protectedBranch=this.$dropdownContainer.find(".create-new-protected-branch"),this.buildDropdown(),this.bindEvents(),this.$dropdownFooter.addClass("hidden")}return _createClass(e,[{key:"buildDropdown",value:function(){var e=this;this.$dropdown.glDropdown({data:this.getProtectedBranches.bind(this),filterable:!0,remote:!1,search:{fields:["title"]},selectable:!0,toggleLabel:function(e){return e&&"id"in e?e.title:"Protected Branch"},fieldName:"protected_branch[name]",text:function(e){return _.escape(e.title)},id:function(e){return _.escape(e.id)},onFilter:this.toggleCreateNewButton.bind(this),clicked:function(t,n,o){o.preventDefault(),e.onSelect()}})}},{key:"bindEvents",value:function(){this.$protectedBranch.on("click",this.onClickCreateWildcard.bind(this))}},{key:"onClickCreateWildcard",value:function(){this.$dropdown.data("glDropdown").remote.execute(),this.$dropdown.data("glDropdown").selectRowAtIndex(0)}},{key:"getProtectedBranches",value:function(e,t){t(this.selectedBranch?gon.open_branches.concat(this.selectedBranch):gon.open_branches)}},{key:"toggleCreateNewButton",value:function(e){this.selectedBranch={title:e,id:e,text:e},e&&this.$dropdownContainer.find(".create-new-protected-branch code").text(e),this.$dropdownFooter.toggleClass("hidden",!e)}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();!function(e){e.gl=e.gl||{},gl.ProtectedBranchEdit=function(){function e(t){_classCallCheck(this,e),this.$wrap=t.$wrap,this.$allowedToMergeDropdown=this.$wrap.find(".js-allowed-to-merge"),this.$allowedToPushDropdown=this.$wrap.find(".js-allowed-to-push"),this.buildDropdowns()}return _createClass(e,[{key:"buildDropdowns",value:function(){new gl.ProtectedBranchAccessDropdown({$dropdown:this.$allowedToMergeDropdown,data:gon.merge_access_levels,onSelect:this.onSelect.bind(this)}),new gl.ProtectedBranchAccessDropdown({$dropdown:this.$allowedToPushDropdown,data:gon.push_access_levels,onSelect:this.onSelect.bind(this)})}},{key:"onSelect",value:function(){var e=this,t=this.$wrap.find('input[name="'+this.$allowedToMergeDropdown.data("fieldName")+'"]'),n=this.$wrap.find('input[name="'+this.$allowedToPushDropdown.data("fieldName")+'"]');t.length&&n.length&&$.ajax({type:"POST",url:this.$wrap.data("url"),dataType:"json",data:{_method:"PATCH",protected_branch:{merge_access_levels_attributes:[{id:this.$allowedToMergeDropdown.data("access-level-id"),access_level:t.val()}],push_access_levels_attributes:[{id:this.$allowedToPushDropdown.data("access-level-id"),access_level:n.val()}]}},success:function(){e.$wrap.effect("highlight")},error:function(){$.scrollTo(0),new Flash("Failed to update branch!")}})}}]),e}()}(window),function(e){e.gl=e.gl||{},gl.ProtectedBranchEditList=function(){function e(){_classCallCheck(this,e),this.$wrap=$(".protected-branches-list"),this.$wrap.find(".js-protected-branch-edit-form").each(function(e,t){new gl.ProtectedBranchEdit({$wrap:$(t)})})}return e}()}(window);